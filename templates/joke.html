{% extends "layout.html" %}

{% block content %}
<header class="d-flex my-3">
<h2 class="display-4 my-1 mr-auto">Шутки:</h2>
<button id="add_meme_button" class="btn btn-success" 
    onclick="$('#add_meme').toggleClass('hidden'); 
    $('#add_meme_button').toggleClass('btn-success btn-danger');
    $('#add_meme_button').text($('#add_meme_button').text() == 'Добавить шутку' ? 'Скрыть' : 'Добавить шутку') ">Добавить шутку</button>
</header>
<div class="card my-3 hidden" id="add_meme">
    <form class="card-body" action="" method="post" enctype="multipart/form-data">
        {{ form.csrf_token }}
        <div class="form-group">
            <label class="my-1">{{ form.joke_text.label}}</label>
            {{ form.joke_text(class=("form-control is-invalid" if form.joke_text.errors else "form-control")) }}
            <div class="invalid-feedback">
            {% if form.joke_text.errors %}
                    {{ form.joke_text.errors[0] }}
            {% endif %}
            </div>
        </div>
        <div class="form-group">
                <label class="my-1">{{ form.joke_password.label}}</label>
                {{ form.joke_password(class=("form-control is-invalid" if form.joke_password.errors else "form-control")) }}
                <div class="invalid-feedback">
                {% if form.joke_password.errors %}
                        {{ form.joke_password.errors[0] }}
                {% endif %}
                </div>
        </div>
        {% if msg %}
           <span><div class="alert alert-danger">{{ msg }}</div></span>
        {% endif %}
        {{ form.joke_submit(class="btn btn-primary btn-block") }}
    </form>
</div>
    {% for item in items|reverse %}
        <div class="card my-2">
            <div class="card-body">
            <p class="joke__text">{{item.text}}</p>
            <p class="italic">
                {{ item.user.username }}
            </p>
            <p>
                <input class="btn btn-success btn-sm" type="button" value="Like" onclick="like({{ item.joke_id }})">
                <label class="my-1" id="joke_likes_{{ item.joke_id }}">{{ item.likes | length }}</label>
            </p>
        </div>
        </div>
    {% endfor %}
<script>function like(int) {
    $.ajax({
      url: "/likeJoke/" + int + "/",
      success: function(data){
        console.log(data);
        if(data != 'Nop')
        $('#joke_likes_' + int).text(data[0].likes);
      }
    });
}
</script>
{% endblock content %}
